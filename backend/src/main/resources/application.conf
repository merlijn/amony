amony {

  amony-home = ${HOME}"/.amony"
  amony-home = ${?AMONY_HOME}

  ffmpeg {
    parallelism = 4
    ffprobe-timeout = 5 seconds
  }

  auth {

    # !!! Note:
    # When enabled = false then authentication is COMPLETELY disabled and EVERYONE has admin access and ALL other auth config is ignored
    # Only recommended for development local only deployments.
    enabled = true
    enabled = ${?AMONY_AUTH_ENABLED}

    require-login = false
    require-login = ${?AMONY_AUTH_REQUIRE_LOGIN}
    
    public-uri = "http://localhost:8182"
    public-uri = ${?AMONY_AUTH_PUBLIC_URI}

    oauth-providers = [
      {
        name = "dex"
        name = ${?AMONY_OAUTH_NAME}
        client-id = "amony-app"
        client-id = ${?AMONY_OAUTH_CLIENT_ID}
        client-secret = "amony-dex-secret"
        client-secret = ${?AMONY_OAUTH_CLIENT_SECRET}
        host = "http://localhost:5556"
        host = ${?AMONY_OAUTH_HOST}
        authorize-endpoint = "/dex/auth"
        authorize-endpoint = ${?AMONY_OAUTH_AUTHORIZE_ENDPOINT}
        token-endpoint = "/dex/token"
        token-endpoint = ${?AMONY_OAUTH_TOKEN_ENDPOINT}
        default-roles = [ "admin" ]
        scopes = [ "openid", "profile", "email" ]
      }
    ]

    secure-cookies = true
    secure-cookies = ${?AMONY_SECURE_COOKIES}

    jwt {
      algorithm {
        type = "HS256"
        secret-key = ${AMONY_JWT_SECRET_KEY}
      }
      access-token-expiration = 15 minutes
      refresh-token-expiration = 7 days
    }

    access-control = {
      anonymous {
        allowed-actions = [ "search", "preview", "view" ]
        hidden-tags = [ ]
        hidden-buckets = [ "private" ]
      }

      authenticated {
        allowed-actions = [ "search", "preview", "view", "upload" ]
        hidden-tags = [ ]
        hidden-buckets = [ ]
      }
    }
  }

  search {

    # the default nr of results returned when no parameter is given
    default-number-of-results = 10

    # the maximum nr of results returned, otherwise a 400 response is returned
    maximum-number-of-results = 128

    solr {
      path = ${amony.amony-home}"/data/solr"
      commit-within-millis = 500
    }
  }

  api {

    host-name = localhost
    web-client-path = /app/assets
    web-client-path = ${?AMONY_WEB_CLIENT_PATH}

    upload-size-limit = 500000

    request-timeout = 10 seconds

    http {
      enabled = true
      enabled = ${?AMONY_HTTP_ENABLED}
      host = "0.0.0.0"
      host = ${?AMONY_HTTP_HOST}
      port = 8182
      port = ${?AMONY_HTTP_PORT}
    }

    # it is recommended to use an https reverse proxy in front of the web server instead of this
    https {
      enabled = false
      enabled = ${?AMONY_HTTPS_ENABLED}
      host = "0.0.0.0"
      host = ${?AMONY_HTTPS_HOST}
      port = 4433
      port = ${?AMONY_HTTPS_PORT}
      private-key-pem = "/path/to/my/privkey.pem"
      certificate-chain-pem = "/path/to/my/fullchain.pem"
    }
  }

  database {
    host = "localhost"
    host = ${?DATABASE_HOST}
    port = 5432
    port = ${?DATABASE_PORT}
    database = "amony"
    database = ${?DATABASE_NAME}
    username = "postgres"
    username = ${?DATABASE_USERNAME}
    password = "changeme"
    password = ${?DATABASE_PASSWORD}
    pool-size = 3
    pool-size = ${?DATABASE_POOL_SIZE}
  }

  resources {
    buckets : [
      {
        id = "media"

        type = "LocalDirectory"

        # location of your media
        path = "../media"
        path = ${?AMONY_MEDIA_PATH}

        # path where to write derived resources such as thumbnails and video fragments
        relative-cache-path = ".amony/cache"

        # path where to write uploaded files
        relative-upload-path = "_upload"

        # the hashing algorithm to use
        hashing-algorithm = {
          type = "partial-hash"
        }

        sync {

          new-files-owner = "admin"

          sync-on-startup = true
          sync-on-startup = ${?AMONY_MEDIA_SYNC_ON_STARTUP}

          # whether to automatically monitor the directory for changes
          enabled = false
          enabled = ${?AMONY_MEDIA_SCAN_ENABLED}

          poll-interval = 300 seconds

          extensions = [ mp4, webm, mkv, mpeg, mpg, wmv, mov, avi, jpg, jpeg, png, webp ]

          # whether to exclude hidden files and directories (starting with a dot)
          exclude-hidden-files = true

          # how many threads to use when scanning
          scan-parallel-factor = 4

          # whether to verify the hashes of already indexed files
          verify-existing-hashes = false
        }
      }
    ]
  }
}